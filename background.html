<script>
  // init
  if (!localStorage['grab_links']) {
    localStorage.setItem('grab_links', JSON.stringify([]));
  }
  function bookmark(tab) {
    var links = JSON.parse(localStorage['grab_links']);
    
    if (!links) { var links = []; }
    chrome.tabs.remove(tab.id);
    
    links.push({
      url: tab.url,
      title: tab.title,
      favicon: tab.favIconUrl
    });
    
//    chrome.browserAction.setBadgeText({text: 'BADGE'});
    localStorage.setItem('grab_links', JSON.stringify(links));
  }
  
  // Called when the user clicks on the browser action.
  chrome.browserAction.onClicked.addListener(function(tab) {
    bookmark(tab);
    alert('Url saved');
  });
  

</script>
