<script>
  // init
  if (!localStorage['grab_links']) {
    localStorage.setItem('grab_links', JSON.stringify([]));
  }
  function bookmark(tab) {
    var links = JSON.parse(localStorage['grab_links']);
    
    if (!links) { var links = []; }
    chrome.tabs.remove(tab.id);
    var linkObject = function createLinkObject() {
        var result = {
            url: tab.url,
            title: tab.title,
            favicon: tab.favIconUrl,
        }
        var date = new Date();
        result.date = date.getTime();
        return result;
    }();
    links.push(linkObject);
    
//    chrome.browserAction.setBadgeText({text: 'BADGE'});
    localStorage.setItem('grab_links', JSON.stringify(links));
  }
  
  // Called when the user clicks on the browser action.
  chrome.browserAction.onClicked.addListener(function(tab) {
    bookmark(tab);
  });
  

</script>
